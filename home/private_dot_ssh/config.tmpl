Include config.d/home
Include config.d/external

Host *                  # apply to all hosts
  AddKeysToAgent yes    # have the ssh command auto-add on first use
{{- if eq .chezmoi.os "darwin" }}
  UseKeychain yes       # make --apple-use-keychain and --apple-load-keychain the default
{{- end }}
{{- if eq .chezmoi.hostname .hostnames.work.intel .hostnames.work.m1 .hostnames.perso.latitude }}
  IdentityFile ~/.ssh/id_rsa
{{- else }}
  IdentityFile ~/.ssh/id_ed25519
{{- end }}

{{- if not .personal }}
# BEGIN ANSIBLE MANAGED BLOCK
Host *
# IPv4 only for speed
AddressFamily inet
Compression yes
ControlMaster auto
ControlPath /tmp/ssh_mux_%h_%p_%r
ControlPersist 10m
# send a keep-alive after 30s of inactivity
ServerAliveInterval 30
# END ANSIBLE MANAGED BLOCK
{{- end }}
